phases:
- client:
    workers:
    - delay: 2ms
      duration: 1200h
      instances: 1
  name: phase1
  setup:
    actions: []
  workload:
    actions:
    - config:
        script: "function run() {\n        // Send a request for authentication\n\
          \        ctx.http_post(ctx.ctx, \"http://auth:8080\", \"{\\\"actions\\\"\
          :[{\\\"name\\\":\\\"Script\\\",\\\"config\\\":{\\\"script\\\":\\\"function\
          \ run() {\\\\n        // Burn\\\\n        ctx.burn(\\\\\\\"10ms\\\\\\\"\
          );\\\\n\\\\n        auth_cache = ctx.get_service(\\\\\\\"auth-cache\\\\\\\
          \");\\\\n        auth_cache.set(ctx.ctx, \\\\\\\"key\\\\\\\", \\\\\\\"value\\\
          \\\\\");\\\\n        auth_cache.get(ctx.ctx, \\\\\\\"key\\\\\\\");\\\\n\
          \    }\\\"}}]}\");\n\n        ctx.http_post(ctx.ctx, \"http://recommendation:8080\"\
          , \"{\\\"actions\\\":[{\\\"name\\\":\\\"Script\\\",\\\"config\\\":{\\\"\
          script\\\":\\\"function run() {\\\\n        // Send a request for authentication\\\
          \\n        ctx.http_post(ctx.ctx, \\\\\\\"http://inventory:8080\\\\\\\"\
          , \\\\\\\"{\\\\\\\\\\\\\\\"actions\\\\\\\\\\\\\\\":[{\\\\\\\\\\\\\\\"name\\\
          \\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Script\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"config\\\
          \\\\\\\\\\\\\":{\\\\\\\\\\\\\\\"script\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"\
          function run() {\\\\\\\\\\\\\\\\n        ctx.burn(\\\\\\\\\\\\\\\\\\\\\\\
          \\\\\\\\\"10ms\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\");\\\\\\\\\\\\\\\\n\\\\\\\\\
          \\\\\\\\n        var inventory_db = ctx.get_service(\\\\\\\\\\\\\\\\\\\\\
          \\\\\\\\\\\"inventory-db\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\");\\\\\\\\\\\\\\\
          \\n        var videos = inventory_db.query(ctx.ctx, \\\\\\\\\\\\\\\\\\\\\
          \\\\\\\\\\\"SELECT * FROM videos ORDER BY created_at DESC LIMIT 20;\\\\\\\
          \\\\\\\\\\\\\\\\\\\\\\\\\");\\\\\\\\\\\\\\\\n\\\\\\\\\\\\\\\\n        //\
          \ now get all the thumbnails\\\\\\\\\\\\\\\\n        var size = 0;\\\\\\\
          \\\\\\\\\\n        storage = ctx.get_service(\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
          \\\"storage\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\");\\\\\\\\\\\\\\\\n        for\
          \ (var i = 0; i < videos.length; i++) {\\\\\\\\\\\\\\\\n            var\
          \ obj = storage.get_object(ctx.ctx, \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"thumbnails\\\
          \\\\\\\\\\\\\\\\\\\\\\\\\\\\\", videos[i].id);\\\\\\\\\\\\\\\\n        \
          \    size += obj.length;\\\\\\\\\\\\\\\\n        }\\\\\\\\\\\\\\\\n\\\\\\\
          \\\\\\\\\\n        ctx.print(\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"Got \\\\\\\\\
          \\\\\\\\\\\\\\\\\\\\\\\" + videos.length + \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
          \" videos with total size: \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\" + size + \\\\\
          \\\\\\\\\\\\\\\\\\\\\\\\\\\" bytes\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\");\\\\\
          \\\\\\\\\\\\n    }\\\\\\\\\\\\\\\"}}]}\\\\\\\");\\\\n    }\\\"}}]}\"); \n\
          \    }"
      name: Script
